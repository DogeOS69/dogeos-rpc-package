services:
  dogecoin-node:
    image: dogeos69/dogecoin:1.14.9
    container_name: dogecoin-node
    restart: unless-stopped
    env_file:
      - ./envs/common/dogecoin.env
      - ./envs/${NETWORK:-testnet}/dogecoin.env
    volumes:
      - ./configs/${NETWORK:-testnet}/dogecoin.conf:/home/dogecoin/.dogecoin/dogecoin.conf
      - dogecoin_data:/data
    ports:
      # Mainnet ports: P2P=22556, RPC=22555
      # Testnet ports: P2P=44556, RPC=44555
      - "${DOGECOIN_P2P_PORT:-44556}:${DOGECOIN_P2P_PORT:-44556}"
      - "${DOGECOIN_RPC_PORT:-44555}:${DOGECOIN_RPC_PORT:-44555}"
    command: ["/dogecoin/bin/dogecoind", "-conf=/home/dogecoin/.dogecoin/dogecoin.conf", "-datadir=/data", "-printtoconsole"]

  l2geth-node:
    image: scrolltech/l2geth:scroll-v5.8.36
    container_name: l2geth-node
    restart: unless-stopped
    env_file:
      - ./envs/common/l2geth.env
      - ./envs/${NETWORK:-testnet}/l2geth.env
    volumes:
      - ./configs/${NETWORK:-testnet}/genesis.json:/l2geth/genesis/genesis.json
      - ./scripts/entrypoint.sh:/entrypoint.sh
      - l2geth_data:/l2geth/data
    ports:
      - "8545:8545"
      - "8546:8546"
      - "30303:30303/tcp"
      - "30303:30303/udp"
    entrypoint: ["/bin/sh", "/entrypoint.sh"]

  celestia-light-node:
    image: ghcr.io/celestiaorg/celestia-node:v0.22.3
    container_name: celestia-light-node
    restart: unless-stopped
    env_file:
      - ./envs/common/celestia.env
      - ./envs/${NETWORK:-testnet}/celestia.env
    volumes:
      - celestia_data:/home/celestia/.celestia-light-${CELESTIA_NETWORK:-mocha-4}
    ports:
      - "${CELESTIA_RPC_PORT:-26658}:26658"
      - "${CELESTIA_GATEWAY_PORT:-26659}:26659"
    command: >
      sh -c "
      celestia light init --p2p.network ${CELESTIA_NETWORK:-mocha} &&
      celestia light start
      --core.ip ${CELESTIA_CORE_IP:-https://rpc-mocha.pops.one}
      --p2p.network ${CELESTIA_NETWORK:-mocha}
      --gateway
      --gateway.addr 0.0.0.0
      --gateway.port 26659
      --rpc.addr 0.0.0.0
      --rpc.port 26658
      "
  l1-interface:
    image: dogeos69/l1-interface:071425-00
    container_name: l1-interface
    restart: unless-stopped
    env_file:
      - ./envs/common/l1-interface.env
      - ./envs/${NETWORK:-testnet}/l1-interface.env
    volumes:
      - ./configs/${NETWORK:-testnet}/genesis.json:/app/genesis/genesis.json:ro
      - l1_interface_data:/data
    ports:
      - "8547:8545"
      - "5052:5052"
      - "9090:9090"
    depends_on:
      - dogecoin-node
      - celestia-light-node
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9090/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    command: ["/usr/local/bin/l1_interface"]

volumes:
  dogecoin_data:
  l2geth_data:
  celestia_data:
  l1_interface_data: